"use strict";

document.addEventListener('DOMContentLoaded', function () {
  // lenis scroll
  var lenis = new Lenis({
    lerp: 0.075,
    smooth: true,
    smoothTouch: true
  });
  function raf(time) {
    lenis.raf(time);
    requestAnimationFrame(raf);
  }
  requestAnimationFrame(raf);

  // function's
  function bodyFixScroll(status) {
    var scrollPosition = 0;
    var paddingOffset = window.innerWidth - document.body.offsetWidth + 'px';
    var elementsFixed = document.querySelectorAll('.fixed');
    if (status) {
      document.body.classList.add('scroll-disabled');
      scrollPosition = window.pageYOffset;
      document.body.style.overflow = 'hidden';
      document.body.style.position = 'fixed';
      if (document.body.style.top) {
        document.body.style.top = document.body.style.top;
      } else {
        document.body.style.top = '-' + scrollPosition + 'px';
      }
      document.body.style.width = '100%';
      document.body.style.paddingRight = paddingOffset;
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.marginRight = paddingOffset;
        });
      }
    } else {
      document.body.classList.remove('scroll-disabled');
      scrollPosition = Math.abs(parseInt(document.querySelector('body').style.top.replace('px', '')));
      document.body.style.removeProperty('overflow');
      document.body.style.removeProperty('position');
      document.body.style.removeProperty('top');
      document.body.style.removeProperty('width');
      document.body.style.removeProperty('padding-right');
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.removeProperty('margin-right');
        });
      }
      window.scrollTo({
        top: !isNaN(scrollPosition) ? scrollPosition : 0,
        behavior: 'instant'
      });
    }
  }

  // slides up/down/toggle
  // Slide Up function (закрытие)
  var slideUp = function slideUp(target) {
    var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 400;
    target.style.transition = "height ".concat(duration, "ms ease, padding ").concat(duration, "ms ease, margin ").concat(duration, "ms ease");
    target.style.height = "".concat(target.offsetHeight, "px"); // Фиксируем текущую высоту
    target.offsetHeight; // Триггер рефлоу
    target.style.overflow = 'hidden';
    target.style.height = '0';
    target.style.paddingTop = '0';
    target.style.paddingBottom = '0';
    target.style.marginTop = '0';
    target.style.marginBottom = '0';
    window.setTimeout(function () {
      target.style.display = 'none';
      target.removeAttribute('style');
      target.parentNode.classList.remove('is--open');
    }, duration);
  };

  // Slide Down function (открытие)
  var slideDown = function slideDown(target) {
    var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 400;
    target.style.removeProperty('display');
    target.style.display = 'block';
    var height = target.scrollHeight; // Правильная высота контента
    target.style.overflow = 'hidden';
    target.style.height = '0';
    target.style.paddingTop = '';
    target.style.paddingBottom = '';
    target.style.marginTop = '';
    target.style.marginBottom = '';
    target.offsetHeight; // Триггер рефлоу
    target.style.transition = "height ".concat(duration, "ms ease, padding ").concat(duration, "ms ease, margin ").concat(duration, "ms ease");
    target.style.height = "".concat(height, "px");
    window.setTimeout(function () {
      target.style.removeProperty('height');
      target.style.removeProperty('overflow');
      target.style.removeProperty('transition');
      target.parentNode.classList.add('is--open');
    }, duration);
  };

  // Accordion logic
  var servicesTriggers = document.querySelectorAll('.services-card__trigger');
  if (servicesTriggers.length) {
    servicesTriggers.forEach(function (trigger) {
      trigger.addEventListener('click', function (event) {
        event.preventDefault();
        var parent = trigger.closest('.services-card');
        var dropdown = parent.querySelector('.services-card__dropdown');
        var openItems = document.querySelectorAll('.services-card.is--open .services-card__dropdown');

        // Закрываем все открытые элементы, кроме текущего
        openItems.forEach(function (item) {
          if (item !== dropdown) {
            slideUp(item);
          }
        });

        // Переключаем состояние текущего элемента
        if (parent.classList.contains('is--open')) {
          slideUp(dropdown);
        } else {
          slideDown(dropdown);
        }
      });
    });
  }

  // checker
  var useItemChecker = function useItemChecker(els, onClickOutside) {
    var checkBodyClick = function checkBodyClick(e) {
      var currentEl = e.target;
      while (currentEl) {
        if (els.includes(currentEl)) break;
        currentEl = currentEl.parentNode;
      }
      if (!currentEl) {
        onClickOutside();
        removeBodyChecker();
      }
    };
    function setBodyChecker() {
      document.documentElement.addEventListener('click', checkBodyClick);
    }
    function removeBodyChecker() {
      document.documentElement.removeEventListener('click', checkBodyClick);
    }
    return {
      setBodyChecker: setBodyChecker,
      removeBodyChecker: removeBodyChecker
    };
  };

  // inputmask
  Inputmask().mask(document.querySelectorAll('input'));

  // textarea
  var allTexareas = document.querySelectorAll('textarea');
  if (allTexareas) {
    allTexareas.forEach(function (el) {
      el.style.height = el.setAttribute('style', 'height: ' + el.scrollHeight + 'px');
      el.classList.add('auto');
      el.addEventListener('input', function (e) {
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
      });
    });
  }

  // // accordeon's
  // const servicesTrigger = document.querySelectorAll('.services-card__trigger')

  // if (servicesTrigger) {
  //     servicesTrigger.forEach(item => {
  //         item.addEventListener('click', (event) => {
  //             event.preventDefault()

  //             const parent = item.closest('.services-card')
  //             const dropdown = parent.querySelector('.services-card__dropdown')

  //             if (!parent.classList.contains('is--open')) {
  //                 slideDownQna(dropdown)
  //             } else {
  //                 slideUpQna(dropdown)
  //             }
  //         })
  //     })
  // }

  // mobile menu
  var mobileMenu = document.getElementById('menu');
  var mobileMenuTrigger = document.getElementById('hamburger-toggle');
  var mobileMenuClose = document.getElementById('menu-close');
  if (mobileMenu && mobileMenuTrigger && mobileMenuClose) {
    mobileMenuTrigger.addEventListener('click', function (event) {
      event.preventDefault();
      if (mobileMenu.classList.contains('is--active')) {
        mobileMenuTrigger.classList.remove('is--active');
        mobileMenu.classList.remove('is--active');
        bodyFixScroll(0);
      } else {
        mobileMenuTrigger.classList.add('is--active');
        mobileMenu.classList.add('is--active');
        bodyFixScroll(1);
      }
    });
    mobileMenuClose.addEventListener('click', function (event) {
      event.preventDefault();
      if (mobileMenu.classList.contains('is--active')) {
        mobileMenuTrigger.classList.remove('is--active');
        mobileMenu.classList.remove('is--active');
        bodyFixScroll(0);
      }
    });
  }
});